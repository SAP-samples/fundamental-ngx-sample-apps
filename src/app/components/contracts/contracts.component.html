<fd-panel>
    <fd-panel-header>
        <fd-panel-head>
            <h2>Contracts</h2>
            <fd-panel-description>Manage the contracts recorded by various company representatives.
            </fd-panel-description>
        </fd-panel-head>
        <fd-panel-actions>
            <button fd-button
                    fdType="light"
                    glyph="add"
                    (click)="openCreateModal()"></button>
        </fd-panel-actions>
    </fd-panel-header>
</fd-panel>
<div class="fd-has-padding-m">
    <div *ngIf="contracts">
        <fd-multi-input 
        [dropdownValues]="contracts"
        [placeholder]="'Search here...'"
        [(ngModel)]="selected"
        [displayFn]="displayFunc">
        </fd-multi-input>
                <span *ngFor="let item of selected; let i = index">
        </span>
    </div>
    <table fd-table cdk-table  [dataSource]="dataSource" #table cdkDropList [cdkDropListData]="dataSource" (cdkDropListDropped)="dropRow($event)">

                    <ng-container   cdkColumnDef="company">
                        <th cdk-header-cell *cdkHeaderCellDef>Company</th> 
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                            <td *ngIf="filterProduct(contract)">
                                        {{contract.company}}
                                    <fd-inline-help [placement]="'right'">
                                        Information about {{contract.company}}
                                    </fd-inline-help>
                                </td>
                            </ng-container>                    
                        </ng-container>

                    <ng-container   cdkColumnDef="contact">
                        <th cdk-header-cell *cdkHeaderCellDef>Contact</th> 
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                            <td *ngIf="filterProduct(contract)">
                                {{contract.contact}}
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container   cdkColumnDef="signed">
                        <th cdk-header-cell *cdkHeaderCellDef>Signed</th>                            
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                            <td *ngIf="filterProduct(contract)">
                            {{contract.date_signed.toDate() | date : 'dd/MM/yyyy'}}
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container   cdkColumnDef="type">
                        <th cdk-header-cell *cdkHeaderCellDef>Type</th>
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                            <td *ngIf="filterProduct(contract)">
                                {{contract.type | uppercase}}
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container   cdkColumnDef="value">
                        <th cdk-header-cell *cdkHeaderCellDef>Value</th>
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                            <td *ngIf="filterProduct(contract)">
                                {{contract.value | currency}}
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container  cdkColumnDef="status">
                        <th cdk-header-cell *cdkHeaderCellDef>Status</th>
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                                <td *ngIf="filterProduct(contract)">
                                <span fd-badge [status]="contract.status | status" modifier="pill"> {{contract.status}} </span>
                            </td>
                        </ng-container>
                    </ng-container> 

                    <ng-container   cdkColumnDef="edit">
                        <th cdk-header-cell *cdkHeaderCellDef>Edit</th>
                        <ng-container cdk-cell *cdkCellDef="let contract">                       
                                <td *ngIf="filterProduct(contract)">
                                <fd-icon glyph="edit"
                                        class="action-button"
                                        tabindex="0"
                                        size="m"
                                        title="Edit Contract"
                                        (click)="openEditModal(contract)">
                                </fd-icon>
                            </td>
                        </ng-container>
                    </ng-container>

                    <ng-container   cdkColumnDef="remove">
                            <th cdk-header-cell *cdkHeaderCellDef >Remove</th>
                            <ng-container cdk-cell *cdkCellDef="let contract">                       
                                    <td *ngIf="filterProduct(contract)">
                                <fd-icon glyph="delete"
                                        class="action-button"
                                        tabindex="0"
                                        size="m"
                                        title="Delete Contract"
                                        (click)="openConfirmModal()">
                                    </fd-icon>
                                </td>
                            </ng-container>
                    </ng-container>
                    <tr cdk-header-row *cdkHeaderRowDef="columnHeaders"></tr>

                    <tr cdk-row cdkDrag [cdkDragData]="row" *cdkRowDef="let row; columns: ['company', 'contact', 'signed', 'type', 'value', 'status','edit', 'remove']" style="cursor: grab;"></tr>
    </table>

    
    <div *ngIf="!(contracts)"
         class="spinner-container">
        <fd-loading-spinner [loading]="true"></fd-loading-spinner>
    </div>
</div>
